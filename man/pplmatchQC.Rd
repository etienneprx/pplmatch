% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pplmatchQC.R
\name{pplmatchQC}
\alias{pplmatchQC}
\title{Appariement des intervenants de l'Assemblee nationale du Quebec}
\usage{
pplmatchQC(
  Corpus,
  Names,
  fuzzy_threshold = 85,
  legislatures = 35:43,
  verbose = FALSE
)
}
\arguments{
\item{Corpus}{Un data frame des debats parlementaires. Doit contenir au
minimum les colonnes :
\describe{
  \item{speaker}{Nom de l'intervenant tel qu'il apparait dans les debats
    (ex: "Legault", "M. Berube", "Le President", "Des Voix").}
  \item{event_date}{Date du debat, en format Date ou caractere YYYY-MM-DD.}
}
Toutes les autres colonnes sont conservees dans le resultat.}

\item{Names}{Un data frame de la table des deputes. Colonnes requises :
\describe{
  \item{full_name}{Nom complet du depute (ex: "Francois Legault").}
  \item{party_id}{Identifiant du parti (ex: "CAQ", "PLQ", "PQ", "QS").}
  \item{gender}{Genre du depute ("m" ou "f").}
  \item{legislature_id}{Numero de la legislature en caractere (ex: "42").}
}
Colonnes optionnelles :
\describe{
  \item{other_names}{Noms alternatifs separes par des points-virgules
    (ex: "Legault; F. Legault"). Utile pour les noms qui different
    entre les debats et la table officielle.}
  \item{district_id}{Identifiant de la circonscription.}
}}

\item{fuzzy_threshold}{Score minimum (0 a 100) pour accepter un match fuzzy.
Defaut : 85. Un seuil plus eleve = plus precis mais moins de matchs.
Un seuil plus bas = plus de matchs mais plus de faux positifs.}

\item{legislatures}{Vecteur d'entiers des numeros de legislatures a traiter.
Defaut : 35:43 (1994 a aujourd'hui). Les lignes du corpus dont la date
tombe hors de ces legislatures recoivent un \code{match_level} de
\code{"unmatched"} et un \code{legislature} de \code{NA}.}

\item{verbose}{Logique. Si \code{TRUE}, affiche la progression et un resume
des resultats a la fin. Defaut : \code{FALSE}.}
}
\value{
Un tibble contenant toutes les colonnes du Corpus original, plus
  les colonnes suivantes :
  \describe{
    \item{legislature}{Numero de la legislature (entier, 35 a 43) determine
      automatiquement a partir de \code{event_date}. \code{NA} si la date
      est hors des legislatures couvertes.}
    \item{speaker_category}{Classification de l'intervenant :
      \code{"person"} (depute), \code{"role"} (fonction institutionnelle
      comme "Le President"), \code{"crowd"} (voix collectives comme
      "Des Voix"), ou \code{"empty"} (champ vide).}
    \item{speaker_normalized}{Version normalisee du nom (minuscules, sans
      accents, sans honorifiques). Vide pour les non-personnes.}
    \item{matched_name}{Nom complet du depute apparie, ou \code{NA} si
      aucun match.}
    \item{party_id}{Parti politique du depute apparie, ou \code{NA}.}
    \item{gender}{Genre du depute apparie, ou \code{NA}.}
    \item{district_id}{Circonscription du depute apparie, ou \code{NA}.}
    \item{match_level}{Niveau de l'appariement :
      \code{"deterministic"} (correspondance exacte),
      \code{"fuzzy"} (similarite au-dessus du seuil),
      \code{"ambiguous"} (plusieurs deputes possibles),
      \code{"unmatched"} (aucune correspondance),
      \code{"role"}, \code{"crowd"}, \code{"empty"}.}
    \item{match_score}{Score de similarite entre 0 et 100. \code{100} pour
      les matchs deterministes, la valeur calculee pour les fuzzy, \code{NA}
      pour les non-matchs.}
  }
}
\description{
Fait correspondre les noms des intervenants dans les debats de l'Assemblee
nationale du Quebec avec la table dimensionnelle des deputes. Utilise un
matching multi-niveaux : deterministe (correspondance exacte apres
normalisation) puis fuzzy (similarite via rapidfuzz en Python).
}
\section{Prerequis}{

Avant la premiere utilisation, executer \code{\link{ensure_python_deps}()}
pour installer les dependances Python (rapidfuzz).
}

\section{Pipeline de matching}{

\enumerate{
  \item **Preprocessing** : classification de l'intervenant, normalisation
    du nom (retrait des honorifiques, accents, chiffres, districts).
  \item **Niveau 1 (deterministe)** : correspondance exacte sur le nom
    complet normalise, puis sur les noms alternatifs, puis sur le nom
    de famille seul (si non-ambigu dans la legislature).
  \item **Niveau 2 (fuzzy)** : si le niveau 1 echoue, comparaison par
    similarite avec rapidfuzz. Score pondere different pour les noms
    complets vs noms de famille seuls.
}
}

\examples{
\dontrun{
# Premiere utilisation : installer les dependances Python
ensure_python_deps()

# Preparer les donnees
corpus <- data.frame(
  speaker = c("Legault", "M. Bérubé", "Le Président", "Des Voix"),
  event_date = as.Date(c("2023-03-15", "2023-03-15", "2023-03-15", "2023-03-15"))
)

members <- data.frame(
  full_name = c("François Legault", "Pascal Bérubé"),
  party_id = c("CAQ", "PQ"),
  gender = c("m", "m"),
  legislature_id = c("43", "43")
)

# Lancer l'appariement
result <- pplmatchQC(corpus, members, fuzzy_threshold = 85, verbose = TRUE)

# Verifier le taux d'appariement (personnes seulement)
persons <- result[result$speaker_category == "person", ]
rate <- sum(persons$match_level \%in\% c("deterministic", "fuzzy")) / nrow(persons)
message(sprintf("Taux d'appariement : \%.1f\%\%", rate * 100))

# Explorer les cas non-apparies
unmatched <- result[result$match_level == "unmatched", ]
table(unmatched$speaker)

# Explorer les cas ambigus
ambiguous <- result[result$match_level == "ambiguous", ]
table(ambiguous$speaker)
}

}
\seealso{
\code{\link{ensure_python_deps}} pour l'installation des dependances,
  \code{\link{data_fetch_qc}} pour recuperer les donnees depuis le datawarehouse,
  \code{\link{generate_gold_sample}} et \code{\link{evaluate_matches_qc}} pour
  l'evaluation de la qualite.
}
